---
{{- if .Values.livekit.enabled }}
apiVersion: v1
kind: Service
metadata:
  name: livekit-server
  namespace: {{ .Release.Namespace }}
  labels:
    app: livekit-server
spec:
  type: ClusterIP
  ports:
  - name: http
    port: 7880
    targetPort: 7880
    protocol: TCP
  - name: rtc-tcp
    port: 7881
    targetPort: 7881
    protocol: TCP
  selector:
    app: livekit-server

---
# LoadBalancer for UDP RTC traffic (uses your existing STUNner/MetalLB)
apiVersion: v1
kind: Service
metadata:
  name: livekit-rtc
  namespace: {{ .Release.Namespace }}
  labels:
    app: livekit-server
  annotations:
    {{- if .Values.stunner.enabled }}
    stunner.l7mp.io/related-gateway: june-stunner-gateway
    {{- end }}
spec:
  type: LoadBalancer
  ports:
  - name: rtc-udp
    port: 50000
    targetPort: 50000
    protocol: UDP
  selector:
    app: livekit-server
{{- end }}