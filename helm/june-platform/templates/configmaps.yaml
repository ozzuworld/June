---
# General application configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: june-config
  namespace: {{ .Release.Namespace }}
data:
  APP_ENV: {{ .Values.global.environment }}
  LOG_LEVEL: info
  REGION: us-central1

---
# LiveKit WebRTC configuration (replaces Janus)
apiVersion: v1
kind: ConfigMap
metadata:
  name: june-webrtc-config
  namespace: {{ .Release.Namespace }}
data:
  # LiveKit connection info for orchestrator (internal cluster communication)
  LIVEKIT_HOST: "livekit-livekit-server.june-services.svc.cluster.local"  # ‚Üê CHANGED from .media.
  LIVEKIT_API_KEY: "devkey"
  LIVEKIT_API_SECRET: "bbUEBtMjPHrvdZwFEwcpPDJkePL5yTrJ"
  
  # Client-facing LiveKit endpoints (external URLs)
  LIVEKIT_PUBLIC_WS_URL: "wss://livekit.{{ .Values.domains.primary }}"
  LIVEKIT_PUBLIC_HTTP_URL: "https://livekit.{{ .Values.domains.primary }}"
  
  # STUN/TURN configuration for LiveKit
  STUN_SERVER: "{{ .Values.domains.turn }}:3478"
  TURN_SERVER: "{{ .Values.domains.turn }}:3478"
  TURN_USERNAME: {{ .Values.stunner.username | quote }}
  TURN_CREDENTIAL: {{ .Values.stunner.password | quote }}

---
# Client configuration (what to send to mobile clients)
apiVersion: v1
kind: ConfigMap
metadata:
  name: june-client-config
  namespace: {{ .Release.Namespace }}
data:
  # WebRTC configuration for clients using LiveKit
  webrtc_config.json: |
    {
      "livekit": {
        "ws_url": "wss://livekit.{{ .Values.domains.primary }}",
        "http_url": "https://livekit.{{ .Values.domains.primary }}",
        "api_key": "devkey"
      },
      "ice_servers": [
        {
          "urls": ["stun:{{ .Values.domains.turn }}:3478"]
        },
        {
          "urls": ["turn:{{ .Values.domains.turn }}:3478"],
          "username": "{{ .Values.stunner.username }}",
          "credential": "{{ .Values.stunner.password }}"
        }
      ]
    }