# OpenCTI Namespace and RBAC
apiVersion: v1
kind: Namespace
metadata:
  name: opencti
  labels:
    app.kubernetes.io/name: opencti
    app.kubernetes.io/instance: opencti-platform
    app.kubernetes.io/version: "6.3.7"
    app.kubernetes.io/component: threat-intelligence
    app.kubernetes.io/part-of: june-osint
    project: june-ai-platform
    environment: production
    managed-by: terraform

---
# Service Account for OpenCTI components
apiVersion: v1
kind: ServiceAccount
metadata:
  name: opencti-serviceaccount
  namespace: opencti
  labels:
    app.kubernetes.io/name: opencti
    app.kubernetes.io/component: platform
  annotations:
    iam.gke.io/gcp-service-account: opencti-gke@main-buffer-469817-v7.iam.gserviceaccount.com

---
# ClusterRole for OpenCTI operations
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: opencti-cluster-role
  labels:
    app.kubernetes.io/name: opencti
rules:
- apiGroups: [""]
  resources: ["pods", "services", "endpoints"]
  verbs: ["get", "list", "watch"]
- apiGroups: ["apps"]
  resources: ["deployments", "replicasets"]
  verbs: ["get", "list", "watch"]
- apiGroups: ["networking.k8s.io"]
  resources: ["networkpolicies"]
  verbs: ["get", "list", "watch"]

---
# ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: opencti-cluster-role-binding
  labels:
    app.kubernetes.io/name: opencti
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: opencti-cluster-role
subjects:
- kind: ServiceAccount
  name: opencti-serviceaccount
  namespace: opencti