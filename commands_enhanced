# Enhanced June STT Build Commands
# Added alongside existing build commands

# Build Enhanced June STT Service
cd June/services/june-stt
docker build -f Dockerfile.new -t june-stt-enhanced:latest .
docker tag june-stt-enhanced:latest ozzuworld/june-stt:enhanced
docker push ozzuworld/june-stt:enhanced

# Build and test locally
docker build -f Dockerfile.new -t june-stt-enhanced:test .
docker run -it --rm -p 8000:8000 \
  -e WHISPER_MODEL=base \
  -e WHISPER_DEVICE=cpu \
  -e LIVEKIT_ENABLED=false \
  june-stt-enhanced:test

# Build with GPU support
docker build -f Dockerfile.new -t june-stt-enhanced:gpu .
docker run -it --rm --gpus all -p 8000:8000 \
  -e WHISPER_MODEL=base \
  -e WHISPER_DEVICE=cuda \
  -e USE_BATCHED_INFERENCE=true \
  june-stt-enhanced:gpu

# Test OpenAI API compatibility
curl -X POST "http://localhost:8000/v1/audio/transcriptions" \
  -F "file=@test_audio.wav" \
  -F "model=base" \
  -F "response_format=json"

# Test health endpoint
curl http://localhost:8000/healthz

# Test stats endpoint
curl http://localhost:8000/stats

# Deploy to Kubernetes (after building and pushing)
kubectl set image deployment/june-stt june-stt=ozzuworld/june-stt:enhanced -n june-services
kubectl rollout status deployment/june-stt -n june-services

# Helm upgrade with enhanced image
helm upgrade june-platform ./helm/june-platform \
  --set stt.image.tag=enhanced \
  --set stt.features.openaiCompatible=true \
  --set stt.features.dynamicLoading=true \
  -n june-services

# Original commands (preserved)
docker tag june-tts-test:latest ozzuworld/june-tts:latest
docker build -t june-tts:latest .
docker build -t june-stt:latest .
docker push ozzuworld/june-tts:latest

# Docker login info (preserved)
# Access permissions: Read, Write, Delete
# To use the access token from your Docker CLI client:
# 1. Run: docker login -u ozzuworld
# 2. At the password prompt, enter the personal access token.
# Token: dckr_pat_IVggHdFCXudTSCfKH41ZVVYIDow

# API Keys (preserved)
# Google: AIzaSyA20vz_9eC0Un6lRrkOKUK5vS-u_zNW1uM
# Cloudflare: PkP4EaKbsqDmnyuc5baNDhVa5xIeOOhtruYTfUEj

# Kubernetes secrets update (preserved)
kubectl patch secret june-secrets \
  --type='merge' \
  -p='{"data":{"tts-service-url":"'$(echo -n "http://142.189.180.177:42243" | base64 -w 0)'"}}' \
  -n june-services

kubectl rollout restart deployment june-orchestrator -n june-services
kubectl rollout status deployment june-orchestrator -n june-services
kubectl get pods -n june-services

# Certificate backup path (preserved)
mkdir /root/.june-certs/
nano /root/.june-certs/ozzu-world-wildcard-tls-backup.yaml

# Test voice cloning (preserved)
curl -X POST "http://localhost:8000/v1/clone" \
  -F "text=Hello, this is a test of voice cloning with F5-TTS" \
  -F "language=en" \
  -F "speed=1.0" \
  -F "reference_text=This is my voice speaking clearly" \
  -F "reference_audio=/home/user/June/test.wav" \
  --output cloned_voice.wav

# Keycloak auth URL (preserved)
# com.example.livekitvoiceapp:/*
# livekit://auth
