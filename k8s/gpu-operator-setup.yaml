# ============================================================================
# GPU OPERATOR TIME-SLICING SETUP (ONE-TIME CONFIGURATION)
# ============================================================================
# Apply this ONCE during cluster setup, BEFORE deploying June services
# 
# Usage:
#   kubectl apply -f k8s/gpu-operator-setup.yaml
#   kubectl patch clusterpolicy/cluster-policy \
#     -n gpu-operator --type merge \
#     -p '{"spec": {"devicePlugin": {"config": {"name": "time-slicing-config", "default": "any"}}}}'
#
# This enables 1 physical GPU to be shared by 4 pods simultaneously
# ============================================================================

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: time-slicing-config
  namespace: gpu-operator
data:
  any: |-
    version: v1
    sharing:
      timeSlicing:
        replicas: 4
        renameByDefault: false
        failRequestsGreaterThanOne: false

---
# Note: After applying this ConfigMap, run the patch command above
# to enable time-slicing in the GPU Operator