# k8s/june-services/harbor-values.yaml
# Harbor configuration with Oracle Autonomous Database backend

expose:
  type: loadBalancer
  loadBalancer:
    IP: ""
    sourceRanges: []
  tls:
    enabled: false  # We'll handle SSL at ingress level

# External URL for Harbor (update this to your actual domain)
externalURL: http://harbor.june-services.svc.cluster.local

# Harbor admin credentials  
harborAdminPassword: "Harbor12345"

# ============================================
# ORACLE DATABASE CONFIGURATION
# ============================================
database:
  type: external
  external:
    host: "adb.us-ashburn-1.oraclecloud.com"
    port: "1522"
    username: "harbor_user"
    password: "HarborPass123!@#"
    coreDatabase: "harbor_user"  # Oracle schema = username
    sslmode: "require"
    
    # Oracle-specific JDBC parameters
    maxIdleConns: 50
    maxOpenConns: 1000
    connMaxLifetime: "5m"
    connMaxIdleTime: "0"

# ============================================
# REDIS CONFIGURATION - Use Harbor built-in
# ============================================
redis:
  type: internal
  internal:
    # Use Harbor's internal Redis for simplicity
    # In production, consider external Redis cluster
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "500m"

# ============================================
# STORAGE CONFIGURATION - Google Cloud Storage
# ============================================
registry:
  storage:
    gcs:
      bucket: "main-buffer-469817-v7-harbor-registry"
      # Use Workload Identity instead of keyfile
      useWorkloadIdentity: true

# ============================================
# AUTOPILOT RESOURCE SPECIFICATIONS
# ============================================
core:
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "500m"
  # Oracle wallet mount
  secretName: "oracle-wallet"

registry:
  controller:
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "200m"

portal:
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "200m"

jobservice:
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "500m"

trivy:
  enabled: true
  resources:
    requests:
      cpu: "200m"
      memory: "512Mi"
    limits:
      cpu: "1000m"
      memory: "1Gi"

notary:
  enabled: false  # Disable for simplicity

# ============================================
# SERVICE ACCOUNT CONFIGURATION
# ============================================
serviceAccount:
  create: false
  name: "harbor"

# ============================================
# ORACLE WALLET CONFIGURATION
# ============================================
# Mount Oracle wallet files for SSL connection
extraEnvVars:
  - name: TNS_ADMIN
    value: "/opt/oracle/wallet"
  - name: ORACLE_HOME
    value: "/opt/oracle"

extraVolumes:
  - name: oracle-wallet
    secret:
      secretName: oracle-wallet
      
extraVolumeMounts:
  - name: oracle-wallet
    mountPath: /opt/oracle/wallet
    readOnly: true

# ============================================
# ORACLE JDBC CONFIGURATION
# ============================================
# Custom configuration for Oracle connectivity
persistence:
  enabled: true
  persistentVolumeClaim:
    registry:
      storageClass: "standard-rwo"
      size: 5Gi
    jobservice:
      storageClass: "standard-rwo"  
      size: 1Gi
    database:
      storageClass: "standard-rwo"
      size: 1Gi
    redis:
      storageClass: "standard-rwo"
      size: 1Gi
    trivy:
      storageClass: "standard-rwo"
      size: 5Gi

# ============================================
# NETWORKING & SECURITY
# ============================================
metrics:
  enabled: true
  
# Enable HTTPS redirect at application level
internalTLS:
  enabled: false

# ============================================
# ORACLE-SPECIFIC ENVIRONMENT VARIABLES
# ============================================
# These will be injected into Harbor core component
coreEnvVars:
  - name: DATABASE_TYPE
    value: "postgresql"  # Harbor expects 'postgresql' even for Oracle
  - name: DATABASE_HOST
    value: "adb.us-ashburn-1.oraclecloud.com"
  - name: DATABASE_PORT
    value: "1522"
  - name: DATABASE_USERNAME
    value: "harbor_user"
  - name: DATABASE_PASSWORD
    value: "HarborPass123!@#"
  - name: DATABASE_DATABASE
    value: "harbor_user"
  - name: DATABASE_SSLMODE
    value: "require"
  - name: DATABASE_MAX_IDLE_CONNS
    value: "50"
  - name: DATABASE_MAX_OPEN_CONNS
    value: "1000"

# ============================================
# LOGGING CONFIGURATION
# ============================================
logLevel: info

# ============================================
# UPDATE STRATEGY
# ============================================
updateStrategy:
  type: RollingUpdate