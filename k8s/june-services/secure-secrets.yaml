# Secure secrets using Google Secret Manager CSI driver
apiVersion: v1
kind: SecretProviderClass
metadata:
  name: june-secrets-provider
  namespace: june-services
spec:
  provider: gcp
  parameters:
    secrets: |
      - resourceName: "projects/main-buffer-469817-v7/secrets/orchestrator-client-secret/versions/latest"
        path: "orchestrator-secret"
      - resourceName: "projects/main-buffer-469817-v7/secrets/stt-client-secret/versions/latest"
        path: "stt-secret"
      - resourceName: "projects/main-buffer-469817-v7/secrets/keycloak-admin-password/versions/latest"
        path: "admin-password"
---
# Updated secure secrets manifest
apiVersion: v1
kind: Secret
metadata:
  name: june-secrets
  namespace: june-services
type: Opaque
stringData:
  # These will be populated by the CSI driver
  ORCHESTRATOR_CLIENT_ID: "orchestrator-client"
  STT_CLIENT_ID: "stt-client"
  # External TTS URL (set this manually after deployment)
  EXTERNAL_TTS_URL: ""
---
# Service account with Workload Identity for secret access
apiVersion: v1
kind: ServiceAccount
metadata:
  name: june-secrets-sa
  namespace: june-services
  annotations:
    iam.gke.io/gcp-service-account: june-secrets-gke@main-buffer-469817-v7.iam.gserviceaccount.com
