# LiveKit Server Configuration
server:
  replicas: 1
  config:
    port: 7880
    rtc:
      udp_port: 7882
      tcp_port: 7881
      port_range_start: 50000
      port_range_end: 60000
      use_external_ip: true
      # CRITICAL: Set external IP explicitly
      external_ip: "34.59.178.219"
      ice_servers:
        - urls: 
          - "stun:stun.l.google.com:19302"
          - "stun:34.59.53.188:3478"  # Your STUNner server
        - urls:
          - "turn:34.59.53.188:3478"
          username: "june-user"
          credential: "Pokemon123!"
    # Enable embedded TURN server for better connectivity
    turn:
      enabled: true
      domain: livekit.ozzu.world
      tls_port: 5349
      udp_port: 3478
    # CRITICAL: WebRTC signaling configuration
    keys:
      devkey: bbUEBtMjPHrvdZwFEwcpPDJkePL5yTrJ
    # Logging configuration
    logging:
      level: debug  # Temporary for troubleshooting
      json: true
    # Development settings for WebSocket handling
    development: false

# API Keys - CRITICAL: Replace with your actual keys
livekit:
  keys:
    # Replace with your actual API key and secret
    devkey: bbUEBtMjPHrvdZwFEwcpPDJkePL5yTrJ
    # Add more key-value pairs as needed
    # ${LIVEKIT_API_KEY}: ${LIVEKIT_API_SECRET}

# Service Configuration
service:
  type: ClusterIP
  ports:
    - name: http
      port: 80
      targetPort: 7880
      protocol: TCP
    - name: ice-tcp
      port: 7881
      targetPort: 7881
      protocol: TCP
    - name: ice-udp
      port: 7882
      targetPort: 7882
      protocol: UDP
    # TURN ports (if using embedded TURN)
    - name: turn-udp
      port: 3478
      targetPort: 3478
      protocol: UDP
    - name: turn-tls
      port: 5349
      targetPort: 5349
      protocol: TCP

# Additional UDP service for WebRTC media
udpService:
  enabled: true
  type: LoadBalancer
  ports:
    - name: ice-udp
      port: 7882
      targetPort: 7882
      protocol: UDP
    - name: turn-udp  
      port: 3478
      targetPort: 3478
      protocol: UDP
  # Port range for WebRTC media (requires LoadBalancer or NodePort)
  portRange:
    start: 50000
    end: 50020  # Reduced range for K8s compatibility