# OpenCTI Helm Values - FIXED VERSION
# File: k8s/opencti/values.yaml

# CRITICAL: Disable all internal search engines
opensearch:
  enabled: false

elasticsearch:
  enabled: false

# Server configuration
server:
  replicaCount: 1
  
  env:
    # FIXED: Use proper OpenSearch connection string
    ELASTICSEARCH__URL: http://opensearch-cluster-master.default.svc.cluster.local:9200
    ELASTICSEARCH__ENGINE_SELECTOR: opensearch
    ELASTICSEARCH__ENGINE_CHECK: "false"
    # CRITICAL: Override the chart's internal elasticsearch hostname
    ELASTICSEARCH__HOSTNAME: opensearch-cluster-master.default.svc.cluster.local
    ELASTICSEARCH__PORT: "9200"
    NODE_OPTIONS: "--max-old-space-size=8096"
    APP__ADMIN__EMAIL: admin@ozzu.world
    APP__ADMIN__PASSWORD: OpenCTI2024!
    APP__ADMIN__TOKEN: ""
    MINIO__ENDPOINT: opencti-minio
    MINIO__PORT: "9000"
    MINIO__ACCESS_KEY: opencti
    MINIO__SECRET_KEY: MinIO2024!
    MINIO__USE_SSL: "false"
    MINIO__BUCKET_NAME: opencti-bucket
    RABBITMQ__HOSTNAME: opencti-rabbitmq
    RABBITMQ__PORT: "5672"
    RABBITMQ__PORT_MANAGEMENT: "15672"
    RABBITMQ__USERNAME: opencti
    RABBITMQ__PASSWORD: RabbitMQ2024!
    REDIS__HOSTNAME: opencti-redis-master
    REDIS__MODE: single
    REDIS__PORT: "6379"
  
  resources:
    requests:
      cpu: 500m
      memory: 2Gi
    limits:
      cpu: 1000m
      memory: 4Gi

worker:
  enabled: true
  replicaCount: 1
  
  env:
    # FIXED: Use proper OpenSearch connection string
    ELASTICSEARCH__URL: http://opensearch-cluster-master.default.svc.cluster.local:9200
    ELASTICSEARCH__ENGINE_SELECTOR: opensearch
    ELASTICSEARCH__ENGINE_CHECK: "false"
    # CRITICAL: Override the chart's internal elasticsearch hostname
    ELASTICSEARCH__HOSTNAME: opensearch-cluster-master.default.svc.cluster.local
    ELASTICSEARCH__PORT: "9200"
    MINIO__ENDPOINT: opencti-minio
    MINIO__PORT: "9000"
    MINIO__ACCESS_KEY: opencti
    MINIO__SECRET_KEY: MinIO2024!
    MINIO__USE_SSL: "false"
    MINIO__BUCKET_NAME: opencti-bucket
    RABBITMQ__HOSTNAME: opencti-rabbitmq
    RABBITMQ__PORT: "5672"
    RABBITMQ__USERNAME: opencti
    RABBITMQ__PASSWORD: RabbitMQ2024!
    REDIS__HOSTNAME: opencti-redis-master
    REDIS__MODE: single
    REDIS__PORT: "6379"
  
  resources:
    requests:
      cpu: 200m
      memory: 1Gi
    limits:
      cpu: 500m
      memory: 2Gi

minio:
  enabled: true
  auth:
    rootUser: opencti
    rootPassword: MinIO2024!
  mode: standalone
  persistence:
    enabled: false

rabbitmq:
  enabled: true
  auth:
    username: opencti
    password: RabbitMQ2024!
  persistence:
    enabled: false
  clustering:
    enabled: false

redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: false
  master:
    persistence:
      enabled: false

ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: opencti.ozzu.world
      paths:
        - path: /
          pathType: Prefix
  tls:
    - hosts:
        - opencti.ozzu.world
      secretName: ozzu-world-wildcard-tls

connector:
  enabled: false

# CRITICAL: Global configuration to override any chart defaults
global:
  elasticsearch:
    enabled: false
  opensearch:
    enabled: false