# Vast.ai GPU Services - Schedule only on Virtual Kubelet node
apiVersion: apps/v1
kind: Deployment
metadata:
  name: june-gpu-multi
  namespace: default
  labels:
    app: june-gpu-multi
spec:
  replicas: 1
  selector:
    matchLabels:
      app: june-gpu-multi
  template:
    metadata:
      labels:
        app: june-gpu-multi
    spec:
      nodeSelector:
        type: virtual-kubelet
      tolerations:
      - key: virtual-kubelet.io/provider
        operator: Exists
        effect: NoSchedule
      containers:
      - name: june-gpu-multi
        image: ozzuworld/june-gpu-multi:latest
        ports:
        - containerPort: 8000
        - containerPort: 8001
        envFrom:
        - secretRef:
            name: june-gpu-secrets
        - configMapRef:
            name: june-config
        resources:
          requests:
            cpu: 200m
            memory: 512Mi
          limits:
            cpu: 2000m
            memory: 4Gi
---
apiVersion: v1
kind: Service
metadata:
  name: june-tts
  namespace: default
  labels:
    app: june-gpu-services
spec:
  selector:
    app: june-gpu-multi
  ports:
  - name: http
    port: 8000
    targetPort: 8000
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  name: june-stt
  namespace: default
  labels:
    app: june-gpu-services
spec:
  selector:
    app: june-gpu-multi
  ports:
  - name: http
    port: 8001
    targetPort: 8001
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  name: june-gpu-services-headless
  namespace: default
  labels:
    app: june-gpu-services
spec:
  selector:
    app: june-gpu-multi
  clusterIP: None
  ports:
  - name: tts
    port: 8000
    targetPort: 8000
  - name: stt
    port: 8001
    targetPort: 8001
