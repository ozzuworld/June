# June/services/june-stt/.env - External deployment configuration

# ===== SERVICE CONFIGURATION =====
SERVICE_NAME=june-stt
PORT=8080
HOST=0.0.0.0

# External URL for this service (for orchestrator callbacks)
EXTERNAL_STT_URL=https://your-stt-domain.com
# Or if using IP: EXTERNAL_STT_URL=http://YOUR_EXTERNAL_IP:8080

# ===== KEYCLOAK AUTHENTICATION (EXTERNAL) =====
# External Keycloak URL (accessible from both STT service and orchestrator)
KEYCLOAK_URL=https://idp.allsafe.world
KEYCLOAK_REALM=allsafe
KEYCLOAK_CLIENT_ID=june-stt
KEYCLOAK_CLIENT_SECRET=gzz55N5XdrMl48UlCNe0Bag5FyoNY0G7

# Token validation
REQUIRED_AUDIENCE=june-stt
JWKS_CACHE_TTL=300

# ===== ORCHESTRATOR INTEGRATION =====
# External orchestrator URL (accessible from your STT infrastructure)
ORCHESTRATOR_URL=https://api.allsafe.world
# Or internal K8s service if you have network connectivity:
# ORCHESTRATOR_URL=http://june-orchestrator.june-services.svc.cluster.local:80

# Service-to-service authentication
ENABLE_ORCHESTRATOR_NOTIFICATIONS=true
ORCHESTRATOR_WEBHOOK_PATH=/v1/stt/webhook

# ===== WHISPER CONFIGURATION =====
WHISPER_MODEL=large-v3
WHISPER_DEVICE=auto  # auto, cpu, cuda

# Model caching (important for external deployment)
WHISPER_CACHE_DIR=/app/models
HF_HOME=/app/cache/huggingface

# ===== CORS CONFIGURATION (IMPORTANT FOR EXTERNAL ACCESS) =====
CORS_ALLOW_ORIGINS=https://api.allsafe.world,https://idp.allsafe.world,http://localhost:3000
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOW_HEADERS=*
CORS_ALLOW_CREDENTIALS=true

# ===== PERFORMANCE & LIMITS =====
MAX_FILE_SIZE_MB=25
MAX_DURATION_MINUTES=30
MAX_CONCURRENT_TRANSCRIPTIONS=3
TRANSCRIPT_RETENTION_HOURS=24

# Request timeouts for external calls
HTTP_TIMEOUT_SECONDS=30
ORCHESTRATOR_TIMEOUT_SECONDS=10

# ===== LOGGING =====
LOG_LEVEL=INFO
LOG_FORMAT=json  # Better for external monitoring

# ===== HEALTH MONITORING =====
HEALTH_CHECK_INTERVAL_SECONDS=30
METRICS_ENABLED=true
METRICS_PORT=9090

# ===== SECURITY =====
# Rate limiting (important for external exposure)
RATE_LIMIT_REQUESTS_PER_MINUTE=100
RATE_LIMIT_BURST_SIZE=20

# API Key for simple authentication fallback (optional)
# API_KEY=your-optional-api-key-for-simple-auth

# ===== EXTERNAL STORAGE (if needed) =====
# For storing large files or transcripts externally
# AWS_ACCESS_KEY_ID=your-aws-key
# AWS_SECRET_ACCESS_KEY=your-aws-secret
# S3_BUCKET=your-transcripts-bucket
# S3_REGION=us-east-1

# ===== NETWORKING =====
# If behind load balancer or proxy
TRUST_PROXY_HEADERS=true
REAL_IP_HEADER=X-Forwarded-For

# TLS/SSL (if terminating SSL at service level)
# SSL_CERT_PATH=/certs/cert.pem
# SSL_KEY_PATH=/certs/key.pem