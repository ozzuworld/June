version: "3.9"

services:
  fish-speech-server:
    image: fishaudio/fish-speech:latest-server-cuda
    container_name: fish-speech-server
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: ["gpu"]
    environment:
      COMPILE: "1"
    volumes:
      - ./checkpoints:/app/checkpoints
      - ./references:/app/references
    ports:
      - "8080:8080"

  fish-fastapi-adapter:
    build: .
    container_name: fish-fastapi-adapter
    environment:
      FISH_SPEECH_BASE_URL: http://fish-speech-server:8080
      REFERENCES_DIR: /app/references
      FISH_SPEECH_TIMEOUT: "180"
    volumes:
      - ./references:/app/references
    ports:
      - "8000:8000"
    depends_on:
      - fish-speech-server
